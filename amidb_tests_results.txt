===============================================
AmiDB Test Suite - BUILD v3.6
===============================================
Fixed: Duplicate check moved to SQL layer
B+Tree now supports UPDATE (upsert behavior)
===============================================


--- Phase 1: Foundation ---

Endian Conversion Tests:
Running endian_u16_roundtrip... OK
Running endian_u16_byte_order... OK
Running endian_u32_roundtrip... OK
Running endian_u32_byte_order... OK
Running endian_u32_zero... OK
Running endian_u32_max... OK

CRC32 Tests:
Running crc32_known_value... OK
Running crc32_empty... OK
Running crc32_incremental... OK
Running crc32_different_data... OK
Running crc32_one_bit_change... OK

--- Phase 2: Storage Engine ---

Pager Tests:
Running pager_mem_test...   Testing memory allocations...
  mem_alloc(64) = 0x400be748
  mem_alloc(32) = 0x400babb0
  mem_alloc(4096) = 0x410ee0a0
  mem_alloc(512) = 0x40d72518
OK
Running pager_file_test...   Attempting file_open with CREATE flag...
  file_open returned: 0x1002f7c1
  file_write returned: 10
OK
Running pager_manual_open...   Step 1: Open file...
    file = 0x1002f7c1
  Step 2: Allocate pager struct (64 bytes)...
    pager_mem = 0x400be748
  Step 3: Allocate page buffer (4096 bytes)...
    page_buf = 0x410ee4b0
  Step 4: Allocate bitmap (512 bytes)...
    bitmap = 0x40d72518
  Step 5: Write page (4096 bytes)...
    file_write returned: 4096 (expected 4096)
  Step 6: Cleanup...
OK
Running pager_create_new...   Creating new database...
[DEBUG] pager_open: path=RAM:test_create_new.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0188
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x410f00e0
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  pager_open returned: 0, pager=0x400c0188
  Checking page count...
  pager_get_page_count returned: 1
OK
Running pager_allocate_pages... [DEBUG] pager_open: path=RAM:test_allocate.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0388
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41303f40
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  First allocated page: 1 (expected 1)
OK
Running pager_write_read_page... [DEBUG] pager_open: path=RAM:test_write_read.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0588
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41327bd0
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Allocated page_num=1, page_count=2 (expected page_num=1, page_count=2)
  pager_write_page returned: 0
  Attempting to read page 1...
  pager_read_page returned: 0
OK
Running pager_checksum_verification... [DEBUG] pager_open: path=RAM:test_checksum.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0788
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4143dc28
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
[DEBUG] pager_open: path=RAM:test_checksum.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0788
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4143dc28
OK
Running pager_reopen_database... [DEBUG] pager_open: path=RAM:test_reopen.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0988
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41484138
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
[DEBUG] pager_open: path=RAM:test_reopen.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0988
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41484138
OK

Cache Tests:
Running cache_create_destroy... [DEBUG] pager_open: path=RAM:cache_create.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0b80
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x414ca648
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
OK
Running cache_get_page_loads... [DEBUG] pager_open: path=RAM:cache_loads.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0d88
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x414ee2d8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  cache_get_page returned: 0
OK
Running cache_lru_eviction... [DEBUG] pager_open: path=RAM:cache_lru.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c0f88
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41511f68
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  After loading 3 pages: cached=3, dirty=0, pinned=0
  After eviction: cached=3, dirty=0, pinned=0
OK
Running cache_pin_prevents_eviction... [DEBUG] pager_open: path=RAM:cache_pin.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1188
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41535bf8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  cache_get_page for 3rd page returned: 0
OK
Running cache_dirty_and_flush... [DEBUG] pager_open: path=RAM:cache_dirty.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1388
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x41559888
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  After marking dirty: cached=1, dirty=1, pinned=1
  After flush: cached=1, dirty=0, pinned=0
OK
Running cache_pin_list... [DEBUG] pager_open: path=RAM:cache_pinlist.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x40d72518
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  After pinning 3 pages: cached=3, dirty=0, pinned=3
  After unpinning all: cached=3, dirty=0, pinned=0
OK

Row Tests:
Running row_init_clear... OK
Running row_integer... OK
Running row_text... OK
Running row_blob... OK
Running row_null... OK
Running row_mixed_types... OK
Running row_serialize_integer...   Serialized 17 bytes
OK
Running row_serialize_text...   Serialized 22 bytes
OK
Running row_serialize_mixed...   Expected size: 26 bytes
  Serialized 26 bytes
OK
Running row_serialize_empty...   Serialized empty row: 2 bytes
OK

--- Phase 3A: B+Tree Basics ---

B+Tree Tests:
Running btree_create_close... [DEBUG] pager_open: path=RAM:btree_create_close.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Created B+Tree with root page 2
OK
Running btree_single_entry... [DEBUG] pager_open: path=RAM:btree_single_entry.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  btree_insert(42, 1000) returned: 0
  btree_search(42) returned: 0, value=1000
  btree_search(99) returned: -1 (expected -1)
OK
Running btree_multiple_entries... [DEBUG] pager_open: path=RAM:btree_multiple_entries.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (30 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 10 entries
  All 10 entries found
OK
Running btree_reverse_order... [DEBUG] pager_open: path=RAM:btree_reverse_order.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (27 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 10 entries in reverse order
  All 10 entries found
OK
Running btree_delete... [DEBUG] pager_open: path=RAM:btree_delete.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 5 entries
  Deleted key 20: 0
  Other entries still found
OK
Running btree_cursor... [DEBUG] pager_open: path=RAM:btree_cursor.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Entry 0: key=0, value=0
  Entry 1: key=10, value=100
  Entry 2: key=20, value=200
  Entry 3: key=30, value=300
  Entry 4: key=40, value=400
  Iterated over 5 entries
OK
Running btree_many_keys... [DEBUG] pager_open: path=RAM:btree_many_keys.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 50 entries
  Stats: entries=50, height=1, nodes=1
  All 50 entries verified
OK
Running btree_update... [DEBUG] pager_open: path=RAM:btree_update.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Successfully updated key 42: 1000 -> 2000
OK

--- Phase 3B: B+Tree Split/Merge ---

B+Tree Split Tests:
Running btree_split_100_keys... [DEBUG] pager_open: path=RAM:btree_split_100.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 100 keys
  Stats: entries=100, height=2, nodes=3
  All 100 keys verified
OK
Running btree_split_500_keys... [DEBUG] pager_open: path=RAM:btree_split_500.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 500 keys
  Stats: entries=500, height=2, nodes=15
  All 500 keys verified
OK
Running btree_split_reverse_500... [DEBUG] pager_open: path=RAM:btree_split_reverse.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (27 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 500 keys in reverse order
  Stats: entries=500, height=2, nodes=15
  All 500 keys verified
OK
Running btree_split_cursor_iteration... [DEBUG] pager_open: path=RAM:btree_split_cursor.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 100 keys
  Cursor iterated over 100 entries correctly
OK
Running btree_split_update_after_split... [DEBUG] pager_open: path=RAM:btree_split_update.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 100 keys
  Updated all 100 keys
  All updates verified
OK

B+Tree Merge Tests:
Running btree_merge_borrow... [DEBUG] pager_open: path=RAM:btree_merge_borrow.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 100 keys
  Deleted 20 keys from beginning
  After deletions: entries=80, height=2, nodes=2
OK
Running btree_merge_trigger... [DEBUG] pager_open: path=RAM:btree_merge_trigger.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (27 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 200 keys
  Before deletions: entries=200, height=2, nodes=6
  Deleted 150 keys
  After deletions: entries=50, height=1, nodes=1
OK
Running btree_merge_500_delete_400... [DEBUG] pager_open: path=RAM:btree_merge_large.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (25 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 500 keys
  After insertions: entries=500, height=2, nodes=15
  Deleted 400 keys
  All 100 remaining keys verified
  After deletions: entries=100, height=2, nodes=2
OK
Running btree_merge_delete_all... [DEBUG] pager_open: path=RAM:btree_merge_empty.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (25 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 100 keys
  Deleted all 100 keys
  After all deletions: entries=0, height=1, nodes=1
  Tree is empty as expected
OK
Running btree_merge_reverse_delete... [DEBUG] pager_open: path=RAM:btree_merge_reverse.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (27 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  Inserted 200 keys
  Deleted 100 keys in reverse order
  After deletions: entries=100, height=2, nodes=3
OK

--- Phase 3C: WAL and Transactions ---

WAL Tests:
Running wal_create_destroy... [DEBUG] pager_open: path=RAM:wal_create.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (18 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running wal_write_begin_commit... [DEBUG] pager_open: path=RAM:wal_write.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running wal_write_page_record... [DEBUG] pager_open: path=RAM:wal_page.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (16 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running wal_flush_to_disk... [DEBUG] pager_open: path=RAM:wal_flush.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running wal_buffer_overflow... [DEBUG] pager_open: path=RAM:wal_overflow.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running wal_checksum_validation... [DEBUG] pager_open: path=RAM:wal_checksum.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK

Transaction Manager Tests:
Running txn_begin_commit... [DEBUG] pager_open: path=RAM:txn_begin_commit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_begin_abort... [DEBUG] pager_open: path=RAM:txn_begin_abort.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_dirty_page_tracking... [DEBUG] pager_open: path=RAM:txn_dirty_track.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_pin_during_transaction... [DEBUG] pager_open: path=RAM:txn_pin.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (15 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_multi_page_commit... [DEBUG] pager_open: path=RAM:txn_multi_page.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (22 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_nested_abort... [DEBUG] pager_open: path=RAM:txn_nested.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (18 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_commit_durability... [DEBUG] pager_open: path=RAM:txn_durability.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (22 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running txn_isolation... [DEBUG] pager_open: path=RAM:txn_isolation.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK

Crash Recovery Tests:
Running recovery_committed_transaction... [DEBUG] pager_open: path=RAM:recovery_commit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] pager_open: path=RAM:recovery_commit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (23 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running recovery_uncommitted_transaction... [DEBUG] pager_open: path=RAM:recovery_uncommit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (25 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] pager_open: path=RAM:recovery_uncommit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (25 bytes)...
[DEBUG] file_path=0x400babb0
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running recovery_partial_commit... [DEBUG] pager_open: path=RAM:recovery_partial.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] pager_open: path=RAM:recovery_partial.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running recovery_multiple_transactions... [DEBUG] pager_open: path=RAM:recovery_multi.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1b98
[DEBUG] Allocating file_path (22 bytes)...
[DEBUG] file_path=0x400ba528
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
  FAIL: tests/test_recovery.c:332: Expected 0, got -1
Running recovery_corrupt_wal_record... [DEBUG] pager_open: path=RAM:recovery_corrupt.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] pager_open: path=RAM:recovery_corrupt.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running recovery_empty_wal... [DEBUG] pager_open: path=RAM:recovery_empty.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (22 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
[DEBUG] pager_open: path=RAM:recovery_empty.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (22 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK

B+Tree Transaction Integration Tests:
Running btree_insert_with_transaction... [DEBUG] pager_open: path=RAM:btree_insert_txn.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running btree_split_with_commit... [DEBUG] pager_open: path=RAM:btree_split_commit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400bebd8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running btree_split_with_abort... [DEBUG] pager_open: path=RAM:btree_split_abort.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (25 bytes)...
[DEBUG] file_path=0x400bebd8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running btree_delete_merge_transaction... [DEBUG] pager_open: path=RAM:btree_delete_merge.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (26 bytes)...
[DEBUG] file_path=0x400bebd8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK
Running btree_complex_multi_operation... [DEBUG] pager_open: path=RAM:btree_complex.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
OK

--- Phase 4: SQL Parser ---

SQL Lexer Tests:
Running lexer_keywords... Testing keyword recognition...
OK
Running lexer_identifiers... Testing identifier parsing...
OK
Running lexer_integers... Testing integer parsing...
OK
Running lexer_strings... Testing string parsing...
OK
Running lexer_symbols... Testing symbol parsing...
OK
Running lexer_whitespace... Testing whitespace handling...
OK
Running lexer_comments... Testing comment handling...
OK
Running lexer_multitoken... Testing multi-token SQL statement...
OK

SQL Parser Tests:
Running parser_create_explicit_pk... Testing CREATE TABLE with explicit PRIMARY KEY...
  Parsed: table='users', columns=2, pk='id'
OK
Running parser_create_implicit_rowid... Testing CREATE TABLE with implicit rowid...
  Parsed: table='posts', columns=2, implicit rowid
OK
Running parser_create_multiple_columns... Testing CREATE TABLE with multiple columns...
  Parsed: table='products', columns=5, all types present
OK
Running parser_create_multiple_pk_error... Testing CREATE TABLE error handling (multiple PRIMARY KEYs)...
  Correctly rejected: Table can have at most one PRIMARY KEY
OK
Running parser_create_no_columns_error... Testing CREATE TABLE error handling (no columns)...
  Correctly rejected: Expected identifier, got ')'
OK
Running parser_trailing_semicolon... Testing CREATE TABLE with trailing semicolon...
OK
Running parser_case_insensitive... Testing case insensitivity...
OK

SQL Catalog Tests:
Running catalog_create_get... START
[DEBUG] pager_open: path=RAM:test_catalog.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4157e148
DONE: 0
OK
Running catalog_implicit_rowid... Testing catalog with implicit rowid...
  [1] Opening pager...
[DEBUG] pager_open: path=RAM:test_catalog2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x428e3a58
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  [1] OK: pager=0x400c1d98
  [2] Creating cache...
  [2] OK: cache=0x400bdf00
  [3] Initializing catalog...
  [3] OK: catalog_tree=0x400bdf18
  [4] Building create_stmt...
  [4] OK: table_name='posts', column_count=2
  [4.5] Testing malloc...
  [4.5] OK: malloc works! test_alloc1=0x412d78d4, test_alloc2=0x412d818c
  [5] Calling catalog_create_table...
  [5] OK: table created
  [6] Calling catalog_get_table...
  [6] OK: schema.name='posts', pk_index=-1, next_rowid=1
  [7] Verifying implicit rowid...
  [7] OK: Created table 'posts' with implicit rowid, next_rowid=1
OK
Running catalog_duplicate_table... Testing catalog duplicate table error...
[DEBUG] pager_open: path=RAM:test_catalog3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42944168
  ERROR: Failed to create first table
Running catalog_drop_table... Testing catalog drop table...
[DEBUG] pager_open: path=RAM:test_catalog4.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42944168
  Successfully dropped table 'temp'
OK
Running catalog_list_tables... Testing catalog list tables...
[DEBUG] pager_open: path=RAM:test_catalog5.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4298aa28
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Table 0: posts
  Table 1: users
  Table 2: products
  Successfully listed 3 tables
OK
Running catalog_persistence... Testing catalog persistence...
[DEBUG] pager_open: path=RAM:test_catalog6.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x429465f8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Created table 'persistent'
[DEBUG] pager_open: path=RAM:test_catalog6.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (21 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x429c2798
  Successfully reopened database, table 'persistent' found
OK

SQL End-to-End Tests:
Running e2e_create_table_explicit_pk... Testing E2E: CREATE TABLE with explicit PRIMARY KEY...
[DEBUG] pager_open: path=RAM:test_e2e1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x429c2798
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  SQL: CREATE TABLE users (id INTEGER PRIMARY KEY, name TEXT, email TEXT)
  ✓ CREATE TABLE executed successfully
  ✓ Table schema verified: name='users', columns=3, pk_index=0, btree_root=2
OK
Running e2e_create_table_implicit_rowid... Testing E2E: CREATE TABLE with implicit rowid...
[DEBUG] pager_open: path=RAM:test_e2e2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4297aa68
  SQL: CREATE TABLE posts (title TEXT, body TEXT, published INTEGER)
  ERROR: Execute failed: Table 'posts' already exists
Running e2e_create_table_validation... Testing E2E: CREATE TABLE validation errors...
[DEBUG] pager_open: path=RAM:test_e2e3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4297aa68
  Test: Duplicate table name...
    ✓ Correctly rejected: Table 'users' already exists
  Test: TEXT PRIMARY KEY...
    ✓ Correctly rejected: PRIMARY KEY must be INTEGER type
OK
Running e2e_multiple_tables... Testing E2E: Multiple tables in same database...
[DEBUG] pager_open: path=RAM:test_e2e4.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4297aa68
  Creating table 'users'...
  Creating table 'posts'...
  Creating table 'comments'...
  ✓ Created 3 tables successfully
  Tables: posts, users, comments
OK
Running e2e_insert_explicit_pk... Testing E2E: INSERT with explicit PRIMARY KEY...
[DEBUG] pager_open: path=RAM:test_insert1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x43610130
  Creating table 'users'...
  ERROR: CREATE TABLE failed: Table 'users' already exists
Running e2e_insert_implicit_rowid... Testing E2E: INSERT with implicit rowid...
[DEBUG] pager_open: path=RAM:test_insert2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42a51a38
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'posts' (implicit rowid)...
  Inserting row 1...
  Inserting row 2...
  ✓ Implicit rowid auto-increment working (next_rowid=3)
OK
Running e2e_insert_validation... Testing E2E: INSERT validation errors...
[DEBUG] pager_open: path=RAM:test_insert3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42abdc38
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Test: Wrong value count...
    ✓ Correctly rejected: Column count mismatch: expected 2, got 1
  Test: Type mismatch...
    ✓ Correctly rejected: Type mismatch for column 'id': expected TEXT
  Test: Duplicate PRIMARY KEY...
    ✓ Correctly rejected: Failed to insert row (duplicate PRIMARY KEY: 1)
OK
Running e2e_select_all... Testing E2E: SELECT * FROM table...
[DEBUG] pager_open: path=RAM:test_select1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42aaa768
  Creating table and inserting data...
  Executing SELECT * FROM users...
  ✓ SELECT * completed successfully
OK
Running e2e_select_where_pk... Testing E2E: SELECT with WHERE on PRIMARY KEY...
[DEBUG] pager_open: path=RAM:test_select2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x43657650
  Creating table and inserting data...
  Executing SELECT * FROM products WHERE id = 200...
  ✓ SELECT with WHERE on PRIMARY KEY completed (fast path)
OK
Running e2e_select_where_nonpk... Testing E2E: SELECT with WHERE on non-PK column...
[DEBUG] pager_open: path=RAM:test_select3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x436345e0
  Creating table and inserting data...
  Executing SELECT * FROM employees WHERE dept = 'Engineering'...
  ✓ SELECT with WHERE on non-PK column completed (table scan)
OK
Running e2e_select_no_match... Testing E2E: SELECT with no matching rows...
[DEBUG] pager_open: path=RAM:test_select4.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (20 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4369db30
  Creating table with limited data...
  Executing SELECT * FROM items WHERE id = 999...
  ✓ SELECT with no matches completed (0 rows returned)
OK
Running e2e_order_by_pk_asc... Testing E2E: ORDER BY PRIMARY KEY ASC...
[DEBUG] pager_open: path=RAM:test_order1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4367aed0
  Creating table and inserting data...
  Executing SELECT * FROM nums ORDER BY id ASC...
  ✓ ORDER BY PRIMARY KEY ASC completed (fast path)
OK
Running e2e_order_by_nonpk... Testing E2E: ORDER BY non-PK column...
[DEBUG] pager_open: path=RAM:test_order2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x436e4010
  Creating table with scores...
  Executing SELECT * FROM scores ORDER BY score DESC...
  ✓ ORDER BY non-PK column DESC completed (in-memory sort)
OK
Running e2e_limit_only... Testing E2E: LIMIT without ORDER BY...
[DEBUG] pager_open: path=RAM:test_limit1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x436c17c0
  Creating table with 10 rows...
  Executing SELECT * FROM items LIMIT 3...
  ✓ LIMIT completed (should show 3 rows)
OK
Running e2e_order_limit_combined... Testing E2E: ORDER BY with LIMIT...
[DEBUG] pager_open: path=RAM:test_order_limit.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (24 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x4372a900
  Creating table with rankings...
  Executing SELECT * FROM ranks ORDER BY points DESC LIMIT 3...
  ✓ ORDER BY with LIMIT completed (top 3 players)
OK

--- Phase 5: Advanced SQL ---

DROP TABLE Tests:
Running e2e_drop_table_basic... Testing E2E: DROP TABLE basic...
[DEBUG] pager_open: path=RAM:test_drop1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (18 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42be2278
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'users'...
  ✓ Table 'users' created successfully
  Dropping table 'users'...
  ✓ Table 'users' dropped successfully
OK
Running e2e_drop_table_nonexistent... Testing E2E: DROP TABLE non-existent...
[DEBUG] pager_open: path=RAM:test_drop2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (18 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42c2b418
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Attempting to drop non-existent table 'fake_table'...
  ✓ Correctly rejected: Table 'fake_table' does not exist
OK
Running e2e_drop_table_recreate... Testing E2E: DROP TABLE then recreate...
[DEBUG] pager_open: path=RAM:test_drop3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (18 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42c2abb8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'products' (2 columns)...
  Dropping table 'products'...
  Recreating table 'products' (3 columns)...
  ✓ Table recreated with new schema (3 columns)
OK

COUNT Aggregate Tests:
Running e2e_count_star_basic... Testing E2E: COUNT(*) basic...
[DEBUG] pager_open: path=RAM:test_count1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42c07368
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'users'...
  Inserting 5 rows...
  Executing SELECT COUNT(*) FROM users...
  ✓ COUNT(*) returned 5
OK
Running e2e_count_star_empty... Testing E2E: COUNT(*) on empty table...
[DEBUG] pager_open: path=RAM:test_count2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42c73968
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating empty table 'items'...
  Executing SELECT COUNT(*) FROM items...
  ✓ COUNT(*) on empty table returned 0
OK
Running e2e_count_star_where... Testing E2E: COUNT(*) with WHERE clause...
[DEBUG] pager_open: path=RAM:test_count3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42cbc2e8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'scores'...
  Executing SELECT COUNT(*) FROM scores WHERE score >= 75...
  ✓ COUNT(*) WHERE score >= 75 returned 3
OK
Running e2e_count_column... Testing E2E: COUNT(column)...
[DEBUG] pager_open: path=RAM:test_count4.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (19 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42c98a58
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'products'...
  Executing SELECT COUNT(name) FROM products...
  ✓ COUNT(name) returned 3
OK

SUM Aggregate Tests:
Running e2e_sum_basic... Testing E2E: SUM basic...
[DEBUG] pager_open: path=RAM:test_sum1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42d05478
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'scores'...
  Inserting rows with points: 10, 20, 30, 40, 50...
  Executing SELECT SUM(points) FROM scores...
  ✓ SUM(points) returned 150
OK
Running e2e_sum_empty... Testing E2E: SUM on empty table...
[DEBUG] pager_open: path=RAM:test_sum2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42ce17d8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating empty table 'values'...
  Executing SELECT SUM(amount) FROM vals...
  ✓ SUM on empty table returned 0
OK
Running e2e_sum_where... Testing E2E: SUM with WHERE clause...
[DEBUG] pager_open: path=RAM:test_sum3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42d4e608
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'orders'...
  Executing SELECT SUM(amount) FROM orders WHERE amount >= 300...
  ✓ SUM WHERE amount >= 300 returned 1200
OK

AVG Aggregate Tests:
Running e2e_avg_basic... Testing E2E: AVG aggregate basic...
[DEBUG] pager_open: path=RAM:test_avg1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42d2ad78
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'scores'...
  Executing SELECT AVG(value) FROM scores...
  ✓ AVG(value) returned 25
OK
Running e2e_avg_empty... Testing E2E: AVG on empty table...
[DEBUG] pager_open: path=RAM:test_avg2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42d72ec8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating empty table 'empty_avg'...
  Executing SELECT AVG(value) FROM empty_avg...
  ✓ AVG on empty table returned 0
OK
Running e2e_avg_where... Testing E2E: AVG with WHERE clause...
[DEBUG] pager_open: path=RAM:test_avg3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42dbc068
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'grades'...
  Executing SELECT AVG(score) FROM grades WHERE score >= 70...
  ✓ AVG WHERE score >= 70 returned 80
OK

MIN Aggregate Tests:
Running e2e_min_basic... Testing E2E: MIN aggregate basic...
[DEBUG] pager_open: path=RAM:test_min1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42d987d8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'temps'...
  Executing SELECT MIN(value) FROM temps...
  ✓ MIN(value) returned 10
OK
Running e2e_min_empty... Testing E2E: MIN on empty table...
[DEBUG] pager_open: path=RAM:test_min2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42de0928
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating empty table 'empty_min'...
  Executing SELECT MIN(value) FROM empty_min...
  ✓ MIN on empty table returned 0
OK
Running e2e_min_where... Testing E2E: MIN with WHERE clause...
[DEBUG] pager_open: path=RAM:test_min3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42e29ac8
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'prices'...
  Executing SELECT MIN(amount) FROM prices WHERE amount >= 300...
  ✓ MIN WHERE amount >= 300 returned 300
OK

MAX Aggregate Tests:
Running e2e_max_basic... Testing E2E: MAX aggregate basic...
[DEBUG] pager_open: path=RAM:test_max1.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42e06238
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'temps'...
  Executing SELECT MAX(value) FROM temps...
  ✓ MAX(value) returned 80
OK
Running e2e_max_empty... Testing E2E: MAX on empty table...
[DEBUG] pager_open: path=RAM:test_max2.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42e4e388
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating empty table 'empty_max'...
  Executing SELECT MAX(value) FROM empty_max...
  ✓ MAX on empty table returned 0
OK
Running e2e_max_where... Testing E2E: MAX with WHERE clause...
[DEBUG] pager_open: path=RAM:test_max3.db, read_only=0
[DEBUG] Allocating pager struct (92 bytes)...
[DEBUG] pager=0x400c1d98
[DEBUG] Allocating file_path (17 bytes)...
[DEBUG] file_path=0x400babc8
[DEBUG] Allocating page_buf (4096 bytes)...
[DEBUG] page_buf=0x42e97528
[DEBUG] Entering new file branch
[DEBUG] Allocating bitmap (512 bytes)...
[DEBUG] bitmap=0x410147c8
[DEBUG] Writing header page...
[DEBUG] file_write returned 4096 (expected 4096)
[DEBUG] Calling file_sync...
  Creating table 'prices'...
  Executing SELECT MAX(amount) FROM prices WHERE amount <= 300...
  ✓ MAX WHERE amount <= 300 returned 300
OK

===============================================
Test Results
===============================================
Passed: 129
Failed: 4
Total:  133
===============================================

*** TESTS FAILED ***

Press RETURN to continue...